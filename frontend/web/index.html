<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>健康智护 - 个人健康动态管理系统</title>
    <link rel="stylesheet" href="css/app.css">
    <script src="js/api.js"></script>
</head>
<body>
    <!-- 侧边栏导航 -->
    <aside class="sidebar" id="sidebar">
        <div class="logo">
            <div class="logo-icon">❤️</div>
            <h1>健康智护</h1>
        </div>
        <nav class="nav-menu">
            <a href="#" class="nav-item active" data-page="dashboard" onclick="showPage('dashboard')">
                <span class="nav-icon">📊</span>
                <span>数据概览</span>
            </a>
            <a href="#" class="nav-item" data-page="health-report" onclick="showPage('health-report')">
                <span class="nav-icon">📋</span>
                <span>健康报告</span>
            </a>
            <a href="#" class="nav-item" data-page="daily-plan" onclick="showPage('daily-plan')">
                <span class="nav-icon">📅</span>
                <span>每日计划</span>
            </a>
            <a href="#" class="nav-item" data-page="nutrition" onclick="showPage('nutrition')">
                <span class="nav-icon">🥗</span>
                <span>饮食建议</span>
            </a>
            <a href="#" class="nav-item" data-page="exercise" onclick="showPage('exercise')">
                <span class="nav-icon">🏃</span>
                <span>运动计划</span>
            </a>
            <a href="#" class="nav-item" data-page="reminders" onclick="showPage('reminders')">
                <span class="nav-icon">🔔</span>
                <span>提醒通知</span>
            </a>
            <a href="#" class="nav-item" data-page="statistics" onclick="showPage('statistics')">
                <span class="nav-icon">📈</span>
                <span>数据统计</span>
            </a>
            <a href="#" class="nav-item" data-page="settings" onclick="showPage('settings')">
                <span class="nav-icon">⚙️</span>
                <span>个人设置</span>
            </a>
        </nav>
        <div class="user-info" id="userInfo">
            <div class="avatar">👤</div>
            <div class="user-details">
                <span class="username" id="currentUser">未登录</span>
                <span class="user-role">普通用户</span>
            </div>
        </div>
    </aside>

    <!-- 主内容区 -->
    <main class="main-content">
        <!-- 顶部栏 -->
        <header class="header">
            <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
            <div class="header-title">
                <h2 id="pageTitle">数据概览</h2>
            </div>
            <div class="header-actions">
                <button class="btn-icon" onclick="showNotifications()">🔔</button>
                <button class="btn-icon" onclick="showHelp()">❓</button>
            </div>
        </header>

        <!-- 页面内容容器 -->
        <div class="content" id="content">
            <!-- 登录页面 -->
            <div id="login-page" class="page">
                <div class="login-container">
                    <div class="login-card">
                        <div class="login-header">
                            <div class="logo-icon-large">❤️</div>
                            <h2>健康智护</h2>
                            <p>个人健康动态管理系统</p>
                        </div>
                        
                        <!-- 统一登录/注册表单 -->
                        <form id="auth-form" class="auth-form" onsubmit="handleAuth(event)">
                            <div class="form-group">
                                <label>用户名</label>
                                <input type="text" id="auth-username" placeholder="请输入用户名" required>
                            </div>
                            <div class="form-group">
                                <label>密码</label>
                                <input type="password" id="auth-password" placeholder="请输入密码" required>
                            </div>
                            <div class="form-group">
                                <label>昵称 <span class="optional">(首次登录将自动注册)</span></label>
                                <input type="text" id="auth-nickname" placeholder="设置您的昵称">
                            </div>
                            <div class="form-group">
                                <label>邮箱 <span class="optional">(可选)</span></label>
                                <input type="email" id="auth-email" placeholder="请输入邮箱">
                            </div>
                            <div class="auth-hint">
                                <span class="hint-icon">💡</span>
                                <span>新用户将自动注册，老用户直接登录</span>
                            </div>
                            <button type="submit" class="btn-primary btn-block" id="auth-btn">开始使用</button>
                        </form>
                    </div>
                </div>
            </div>

            <!-- 数据概览页面 -->
            <div id="dashboard-page" class="page">
                <div class="dashboard-grid">
                    <!-- 今日概览 -->
                    <div class="card">
                        <div class="card-header">
                            <h3>今日概览</h3>
                        </div>
                        <div class="card-body">
                            <div class="stat-cards">
                                <div class="stat-card">
                                    <div class="stat-icon breakfast">🍳</div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="todayBreakfast">--</span>
                                        <span class="stat-label">早餐</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon lunch">🍱</div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="todayLunch">--</span>
                                        <span class="stat-label">午餐</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon dinner">🍽️</div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="todayDinner">--</span>
                                        <span class="stat-label">晚餐</span>
                                    </div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-icon exercise">🏃</div>
                                    <div class="stat-info">
                                        <span class="stat-value" id="todayExercise">--</span>
                                        <span class="stat-label">运动</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 热量统计 -->
                    <div class="card">
                        <div class="card-header">
                            <h3>热量追踪</h3>
                            <span class="date-badge" id="todayDate"></span>
                        </div>
                        <div class="card-body">
                            <div class="calorie-display">
                                <div class="calorie-circle">
                                    <svg viewBox="0 0 100 100">
                                        <circle cx="50" cy="50" r="45" fill="none" stroke="#e0e0e0" stroke-width="8"/>
                                        <circle id="calorieProgress" cx="50" cy="50" r="45" fill="none" stroke="#4CAF50" stroke-width="8" stroke-dasharray="283" stroke-dashoffset="283"/>
                                    </svg>
                                    <div class="calorie-text">
                                        <span class="calorie-current" id="calorieCurrent">0</span>
                                        <span class="calorie-unit">千卡</span>
                                        <span class="calorie-target">/ <span id="calorieTarget">2000</span> 千卡</span>
                                    </div>
                                </div>
                            </div>
                            <div class="macro-nutrients">
                                <div class="macro-item">
                                    <div class="macro-bar protein" id="proteinBar" style="width: 0%"></div>
                                    <span class="macro-label">蛋白质 <span id="proteinValue">0g</span></span>
                                </div>
                                <div class="macro-item">
                                    <div class="macro-bar carbs" id="carbsBar" style="width: 0%"></div>
                                    <span class="macro-label">碳水 <span id="carbsValue">0g</span></span>
                                </div>
                                <div class="macro-item">
                                    <div class="macro-bar fat" id="fatBar" style="width: 0%"></div>
                                    <span class="macro-label">脂肪 <span id="fatValue">0g</span></span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 连续打卡 -->
                    <div class="card">
                        <div class="card-header">
                            <h3>打卡记录</h3>
                        </div>
                        <div class="card-body">
                            <div class="streak-display">
                                <div class="streak-main">
                                    <span class="streak-number" id="currentStreak">0</span>
                                    <span class="streak-label">连续打卡</span>
                                </div>
                                <div class="streak-stats">
                                    <div class="streak-item">
                                        <span class="streak-value" id="totalDays">0</span>
                                        <span class="streak-label">累计天数</span>
                                    </div>
                                    <div class="streak-item">
                                        <span class="streak-value" id="bestStreak">0</span>
                                        <span class="streak-label">最佳记录</span>
                                    </div>
                                </div>
                            </div>
                            <div class="calendar-strip" id="calendarStrip">
                                <!-- 日历条纹将通过 JS 动态生成 -->
                            </div>
                        </div>
                    </div>

                    <!-- 健康指标 -->
                    <div class="card">
                        <div class="card-header">
                            <h3>健康指标</h3>
                            <button class="btn-small" onclick="showPage('health-report')">更新报告</button>
                        </div>
                        <div class="card-body">
                            <div class="health-metrics">
                                <div class="metric-item">
                                    <span class="metric-label">BMI</span>
                                    <span class="metric-value" id="bmiValue">--</span>
                                    <span class="metric-status" id="bmiStatus">待测量</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">体重</span>
                                    <span class="metric-value" id="weightValue">--</span>
                                    <span class="metric-unit">kg</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">睡眠</span>
                                    <span class="metric-value" id="sleepValue">--</span>
                                    <span class="metric-unit">小时</span>
                                </div>
                                <div class="metric-item">
                                    <span class="metric-label">运动</span>
                                    <span class="metric-value" id="exerciseValue">--</span>
                                    <span class="metric-unit">分钟</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 今日任务 -->
                    <div class="card full-width">
                        <div class="card-header">
                            <h3>今日任务</h3>
                            <span class="completion-rate" id="todayCompletion">完成 0/0</span>
                        </div>
                        <div class="card-body">
                            <div class="task-list" id="todayTasks">
                                <div class="task-empty">暂无今日任务，请先提交健康报告</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 健康报告页面 -->
            <div id="health-report-page" class="page hidden">
                <div class="page-header">
                    <h2>健康报告</h2>
                    <p>提交您的健康数据，获取个性化健康建议</p>
                </div>
                <form id="health-report-form" class="report-form" onsubmit="handleReportSubmit(event)">
                    <div class="form-section">
                        <h3>📏 身体指标</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>身高 (cm)</label>
                                <input type="number" id="height" placeholder="请输入身高" min="100" max="250" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label>体重 (kg)</label>
                                <input type="number" id="weight" placeholder="请输入体重" min="30" max="200" step="0.1" required>
                            </div>
                            <div class="form-group">
                                <label>体脂率 (%)</label>
                                <input type="number" id="bodyFatRate" placeholder="请输入体脂率" min="5" max="50" step="0.1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>肌肉量 (kg)</label>
                                <input type="number" id="muscleMass" placeholder="请输入肌肉量" min="10" max="100" step="0.1">
                            </div>
                            <div class="form-group">
                                <label>收缩压 (mmHg)</label>
                                <input type="number" id="systolicPressure" placeholder="请输入收缩压" min="60" max="250">
                            </div>
                            <div class="form-group">
                                <label>舒张压 (mmHg)</label>
                                <input type="number" id="diastolicPressure" placeholder="请输入舒张压" min="40" max="150">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>😴 睡眠情况</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>平均睡眠时长 (小时)</label>
                                <input type="number" id="sleepHoursAvg" placeholder="请输入平均睡眠时长" min="3" max="12" step="0.5">
                            </div>
                            <div class="form-group">
                                <label>睡眠质量 (1-10)</label>
                                <input type="number" id="sleepQuality" placeholder="1-10分" min="1" max="10">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>生活习惯</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>是否吸烟</label>
                                <select id="smoking">
                                    <option value="false">否</option>
                                    <option value="true">是</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>是否饮酒</label>
                                <select id="drinking">
                                    <option value="false">否</option>
                                    <option value="true">是</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>运动频率 (次/周)</label>
                                <input type="number" id="exerciseFrequency" placeholder="请输入每周运动次数" min="0" max="7">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>🥗 饮食偏好</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>饮食偏好</label>
                                <select id="dietaryPreferences">
                                    <option value="">无特殊偏好</option>
                                    <option value="素食">素食</option>
                                    <option value="低脂">低脂饮食</option>
                                    <option value="低碳水">低碳水饮食</option>
                                    <option value="高蛋白">高蛋白饮食</option>
                                    <option value="无麸质">无麸质饮食</option>
                                    <option value="清淡">清淡饮食</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>食物过敏史</label>
                                <input type="text" id="foodAllergies" placeholder="请输入过敏食物，多个用逗号分隔">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>🎯 健康目标</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>健康目标</label>
                                <select id="healthGoal" required>
                                    <option value="">请选择目标</option>
                                    <option value="lose_weight">减重</option>
                                    <option value="maintain_weight">维持体重</option>
                                    <option value="gain_weight">增重</option>
                                    <option value="build_muscle">增肌</option>
                                    <option value="improve_sleep">改善睡眠</option>
                                    <option value="enhance_energy">提升精力</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>目标体重 (kg)</label>
                                <input type="number" id="targetWeight" placeholder="请输入目标体重" min="30" max="200" step="0.1">
                            </div>
                        </div>
                    </div>

                    <div class="form-section">
                        <h3>📝 其他信息</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label>压力水平 (1-10)</label>
                                <input type="number" id="stressLevel" placeholder="1-10分" min="1" max="10">
                            </div>
                            <div class="form-group">
                                <label>精力水平 (1-10)</label>
                                <input type="number" id="energyLevel" placeholder="1-10分" min="1" max="10">
                            </div>
                        </div>
                        <div class="form-group full-width">
                            <label>病史信息</label>
                            <textarea id="medicalHistory" placeholder="请输入既往病史，如有请详细描述"></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>正在服用的药物</label>
                            <textarea id="medications" placeholder="请输入正在服用的药物"></textarea>
                        </div>
                        <div class="form-group full-width">
                            <label>备注</label>
                            <textarea id="additionalNotes" placeholder="其他需要说明的情况"></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn-secondary" onclick="resetReportForm()">重置</button>
                        <button type="submit" class="btn-primary">提交报告</button>
                    </div>
                </form>
            </div>

            <!-- 每日计划页面 -->
            <div id="daily-plan-page" class="page hidden">
                <div class="page-header">
                    <h2>每日计划</h2>
                    <div class="date-selector">
                        <button class="btn-small" onclick="changeDate(-1)">◀ 昨天</button>
                        <span id="selectedDate" class="date-display"></span>
                        <button class="btn-small" onclick="changeDate(1)">明天 ▶</button>
                    </div>
                </div>
                <div class="daily-plan-container">
                    <div class="plan-summary card">
                        <div class="card-header">
                            <h3>今日概览</h3>
                            <span class="plan-status" id="planStatus">进行中</span>
                        </div>
                        <div class="card-body">
                            <div class="summary-stats">
                                <div class="summary-item">
                                    <span class="summary-label">热量目标</span>
                                    <span class="summary-value" id="dailyCalorieGoal">-- 千卡</span>
                                </div>
                                <div class="summary-item">
                                    <span class="summary-label">已完成</span>
                                    <span class="summary-value" id="dailyCompletion">--%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="meal-section">
                        <h3>🍽️ 饮食计划</h3>
                        <div class="meal-cards">
                            <div class="meal-card breakfast">
                                <div class="meal-header">
                                    <span class="meal-icon">🍳</span>
                                    <span class="meal-title">早餐</span>
                                </div>
                                <div class="meal-content" id="mealBreakfast">
                                    <p class="meal-empty">暂无早餐建议</p>
                                </div>
                            </div>
                            <div class="meal-card lunch">
                                <div class="meal-header">
                                    <span class="meal-icon">🍱</span>
                                    <span class="meal-title">午餐</span>
                                </div>
                                <div class="meal-content" id="mealLunch">
                                    <p class="meal-empty">暂无午餐建议</p>
                                </div>
                            </div>
                            <div class="meal-card dinner">
                                <div class="meal-header">
                                    <span class="meal-icon">🍽️</span>
                                    <span class="meal-title">晚餐</span>
                                </div>
                                <div class="meal-content" id="mealDinner">
                                    <p class="meal-empty">暂无晚餐建议</p>
                                </div>
                            </div>
                            <div class="meal-card snacks">
                                <div class="meal-header">
                                    <span class="meal-icon">🍪</span>
                                    <span class="meal-title">加餐</span>
                                </div>
                                <div class="meal-content" id="mealSnacks">
                                    <p class="meal-empty">暂无加餐建议</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="exercise-section">
                        <h3>🏃 运动计划</h3>
                        <div class="exercise-card" id="exercisePlan">
                            <div class="exercise-header">
                                <span class="exercise-icon">🏃</span>
                                <div class="exercise-info">
                                    <span class="exercise-type" id="exerciseType">--</span>
                                    <span class="exercise-duration" id="exerciseDuration">-- 分钟</span>
                                </div>
                                <span class="exercise-intensity" id="exerciseIntensity">--</span>
                            </div>
                            <div class="exercise-description" id="exerciseDescription">
                                暂无运动计划
                            </div>
                        </div>
                    </div>

                    <div class="reminders-section">
                        <h3>📌 注意事项</h3>
                        <div class="reminders-list" id="dailyReminders">
                            <div class="reminder-empty">暂无提醒</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 饮食建议页面 -->
            <div id="nutrition-page" class="page hidden">
                <div class="page-header">
                    <h2>饮食建议</h2>
                </div>
                <div class="nutrition-container">
                    <div class="nutrition-goals card">
                        <div class="card-header">
                            <h3>每日营养目标</h3>
                        </div>
                        <div class="card-body">
                            <div class="nutrition-display">
                                <div class="nutrition-circle">
                                    <svg viewBox="0 0 100 100">
                                        <circle cx="50" cy="50" r="45" fill="none" stroke="#e0e0e0" stroke-width="8"/>
                                        <circle id="nutritionProgress" cx="50" cy="50" r="45" fill="none" stroke="#4CAF50" stroke-width="8" stroke-dasharray="283" stroke-dashoffset="283"/>
                                    </svg>
                                    <div class="nutrition-text">
                                        <span class="nutrition-calories" id="nutritionCalories">2000</span>
                                        <span class="nutrition-unit">千卡</span>
                                    </div>
                                </div>
                                <div class="nutrition-macros">
                                    <div class="macro-circle">
                                        <svg viewBox="0 0 36 36">
                                            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                            <path id="proteinCircle" class="circle-fill protein" stroke-dasharray="100, 100"/>
                                        </svg>
                                        <span class="macro-percent" id="proteinPercent">15%</span>
                                        <span class="macro-name">蛋白质</span>
                                    </div>
                                    <div class="macro-circle">
                                        <svg viewBox="0 0 36 36">
                                            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                            <path id="carbsCircle" class="circle-fill carbs" stroke-dasharray="50, 100"/>
                                        </svg>
                                        <span class="macro-percent" id="carbsPercent">50%</span>
                                        <span class="macro-name">碳水</span>
                                    </div>
                                    <div class="macro-circle">
                                        <svg viewBox="0 0 36 36">
                                            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                            <path id="fatCircle" class="circle-fill fat" stroke-dasharray="35, 100"/>
                                        </svg>
                                        <span class="macro-percent" id="fatPercent">35%</span>
                                        <span class="macro-name">脂肪</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="nutrition-tips card">
                        <div class="card-header">
                            <h3>健康饮食小贴士</h3>
                        </div>
                        <div class="card-body">
                            <ul class="tips-list" id="nutritionTips">
                                <li>保持均衡饮食，多吃蔬菜水果</li>
                                <li>控制每日总热量摄入</li>
                                <li>少吃高糖、高脂肪食物</li>
                                <li>保持充足的饮水，每天至少8杯水</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 运动计划页面 -->
            <div id="exercise-page" class="page hidden">
                <div class="page-header">
                    <h2>运动计划</h2>
                </div>
                <div class="exercise-container">
                    <div class="weekly-summary card">
                        <div class="card-header">
                            <h3>本周运动概览</h3>
                        </div>
                        <div class="card-body">
                            <div class="weekly-stats">
                                <div class="weekly-stat">
                                    <span class="weekly-value" id="weeklyExercises">0</span>
                                    <span class="weekly-label">已运动次数</span>
                                </div>
                                <div class="weekly-stat">
                                    <span class="weekly-value" id="weeklyMinutes">0</span>
                                    <span class="weekly-label">总分钟数</span>
                                </div>
                                <div class="weekly-stat">
                                    <span class="weekly-value" id="weeklyCalories">0</span>
                                    <span class="weekly-label">消耗千卡</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="exercise-history">
                        <h3>📋 运动记录</h3>
                        <div class="exercise-list" id="exerciseHistory">
                            <div class="exercise-empty">暂无运动记录</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 提醒通知页面 -->
            <div id="reminders-page" class="page hidden">
                <div class="page-header">
                    <h2>提醒通知</h2>
                </div>
                <div class="reminders-container">
                    <div class="reminder-filters">
                        <button class="filter-btn active" onclick="filterReminders('all')">全部</button>
                        <button class="filter-btn" onclick="filterReminders('unread')">未读</button>
                        <button class="filter-btn" onclick="filterReminders('meal')">餐食</button>
                        <button class="filter-btn" onclick="filterReminders('exercise')">运动</button>
                    </div>
                    <div class="reminders-list-full" id="allReminders">
                        <div class="reminder-empty">暂无提醒</div>
                    </div>
                </div>
            </div>

            <!-- 数据统计页面 -->
            <div id="statistics-page" class="page hidden">
                <div class="page-header">
                    <h2>数据统计</h2>
                    <div class="period-selector">
                        <button class="period-btn active" onclick="changePeriod('week')">本周</button>
                        <button class="period-btn" onclick="changePeriod('month')">本月</button>
                        <button class="period-btn" onclick="changePeriod('all')">全部</button>
                    </div>
                </div>
                <div class="statistics-container">
                    <div class="stats-cards">
                        <div class="stat-card-large">
                            <div class="stat-header">
                                <span class="stat-icon">📊</span>
                                <span class="stat-title">计划完成度</span>
                            </div>
                            <div class="stat-content">
                                <div class="progress-ring">
                                    <svg viewBox="0 0 100 100">
                                        <circle cx="50" cy="50" r="45" fill="none" stroke="#e0e0e0" stroke-width="10"/>
                                        <circle id="completionProgress" cx="50" cy="50" r="45" fill="none" stroke="#4CAF50" stroke-width="10" stroke-dasharray="283" stroke-dashoffset="283"/>
                                    </svg>
                                    <span class="progress-value" id="completionRate">0%</span>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card-large">
                            <div class="stat-header">
                                <span class="stat-icon">🔥</span>
                                <span class="stat-title">热量摄入</span>
                            </div>
                            <div class="stat-content">
                                <div class="calorie-stats">
                                    <div class="calorie-item">
                                        <span class="calorie-label">计划摄入</span>
                                        <span class="calorie-value" id="plannedCalories">0 千卡</span>
                                    </div>
                                    <div class="calorie-item">
                                        <span class="calorie-label">实际摄入</span>
                                        <span class="calorie-value" id="actualCalories">0 千卡</span>
                                    </div>
                                    <div class="calorie-item">
                                        <span class="calorie-label">偏差</span>
                                        <span class="calorie-value" id="calorieDeviation">0 千卡</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="stat-card-large">
                            <div class="stat-header">
                                <span class="stat-icon">🏃</span>
                                <span class="stat-title">运动统计</span>
                            </div>
                            <div class="stat-content">
                                <div class="exercise-stats">
                                    <div class="exercise-stat">
                                        <span class="exercise-label">计划运动</span>
                                        <span class="exercise-value" id="plannedExercise">0 分钟</span>
                                    </div>
                                    <div class="exercise-stat">
                                        <span class="exercise-label">实际运动</span>
                                        <span class="exercise-value" id="actualExercise">0 分钟</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="chart-section">
                        <h3>📈 完成趋势</h3>
                        <div class="chart-container" id="completionChart">
                            <div class="chart-placeholder">
                                <div class="bar-chart" id="barChart">
                                    <!-- 柱状图将通过 JS 动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 个人设置页面 -->
            <div id="settings-page" class="page hidden">
                <div class="page-header">
                    <h2>个人设置</h2>
                </div>
                <div class="settings-container">
                    <div class="settings-section card">
                        <div class="card-header">
                            <h3>👤 个人信息</h3>
                        </div>
                        <div class="card-body">
                            <form id="profile-form" onsubmit="handleProfileUpdate(event)">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>用户名</label>
                                        <input type="text" id="profileUsername" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label>昵称</label>
                                        <input type="text" id="profileNickname" placeholder="设置昵称">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>邮箱</label>
                                        <input type="email" id="profileEmail" placeholder="请输入邮箱">
                                    </div>
                                    <div class="form-group">
                                        <label>手机号</label>
                                        <input type="tel" id="profilePhone" placeholder="请输入手机号">
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>性别</label>
                                        <select id="profileGender">
                                            <option value="">请选择</option>
                                            <option value="male">男</option>
                                            <option value="female">女</option>
                                            <option value="other">其他</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>出生日期</label>
                                        <input type="date" id="profileBirthDate">
                                    </div>
                                </div>
                                <div class="form-actions">
                                    <button type="submit" class="btn-primary">保存修改</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <div class="settings-section card">
                        <div class="card-header">
                            <h3>🔔 通知设置</h3>
                        </div>
                        <div class="card-body">
                            <div class="notification-settings">
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-name">餐食提醒</span>
                                        <span class="setting-desc">提醒您按时进食</span>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="mealReminder" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-name">运动提醒</span>
                                        <span class="setting-desc">提醒您完成今日运动</span>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="exerciseReminder" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <span class="setting-name">每日鼓励</span>
                                        <span class="setting-desc">发送温馨鼓励信息</span>
                                    </div>
                                    <label class="switch">
                                        <input type="checkbox" id="encouragement" checked>
                                        <span class="slider"></span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="settings-section card">
                        <div class="card-header">
                            <h3>🚪 账户操作</h3>
                        </div>
                        <div class="card-body">
                            <div class="account-actions">
                                <button class="btn-danger" onclick="handleLogout()">退出登录</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 通知弹窗 -->
    <div id="notification-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>通知</h3>
                <button class="modal-close" onclick="closeNotificationModal()">&times;</button>
            </div>
            <div class="modal-body" id="notificationContent">
            </div>
        </div>
    </div>

    <!-- 帮助弹窗 -->
    <div id="help-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>使用帮助</h3>
                <button class="modal-close" onclick="closeHelpModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="help-content">
                    <h4>欢迎使用健康智护系统！</h4>
                    <p>本系统帮助您管理个人健康，通过以下步骤开始使用：</p>
                    <ol>
                        <li><strong>注册/登录</strong> - 创建账户或使用已有账户登录</li>
                        <li><strong>提交健康报告</strong> - 填写您的身体指标、生活习惯等信息</li>
                        <li><strong>获取个性化计划</strong> - 系统自动生成30天健康计划</li>
                        <li><strong>每日执行</strong> - 按照计划完成每日任务</li>
                        <li><strong>查看统计</strong> - 跟踪您的健康进度</li>
                    </ol>
                    <p>如有疑问，请联系客服。</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast 通知 -->
    <div id="toast-container"></div>

    <script>
        // 全局变量
        let currentUser = null;
        let selectedDate = new Date();
        let currentPeriod = 'week';

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        // 初始化应用
        function initializeApp() {
            // 检查用户是否已登录
            checkLoginStatus();
            
            // 设置今日日期
            updateDateDisplay();
            
            // 生成日历条纹
            generateCalendarStrip();
            
            // 加载数据
            if (currentUser) {
                loadDashboardData();
            }
        }

        // 检查登录状态
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('healthsmart_user');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUserDisplay();
                showPage('dashboard');
            } else {
                showPage('login');
            }
        }

        // 更新用户显示
        function updateUserDisplay() {
            if (currentUser) {
                document.getElementById('currentUser').textContent = currentUser.nickname || currentUser.username;
            }
        }

        // 统一认证处理（登录或自动注册）
        async function handleAuth(event) {
            event.preventDefault();
            
            const username = document.getElementById('auth-username').value.trim();
            const password = document.getElementById('auth-password').value;
            const nickname = document.getElementById('auth-nickname').value.trim();
            const email = document.getElementById('auth-email').value.trim();
            
            if (username.length < 2) {
                showToast('用户名至少需要2个字符', 'error');
                return;
            }
            
            if (password.length < 3) {
                showToast('密码至少需要3个字符', 'error');
                return;
            }
            
            const btn = document.getElementById('auth-btn');
            btn.disabled = true;
            btn.textContent = '正在处理...';
            
            try {
                const response = await HealthSmartAPI.auth(username, password, nickname, email);
                
                if (response.success) {
                    currentUser = response.data;
                    localStorage.setItem('healthsmart_user', JSON.stringify(currentUser));
                    updateUserDisplay();
                    
                    // 根据是否是新用户显示不同提示
                    if (currentUser.isNewUser) {
                        showToast('新用户注册成功！欢迎使用健康智护！', 'success');
                    } else {
                        showToast('登录成功！欢迎回来，' + (currentUser.nickname || currentUser.username) + '！', 'success');
                    }
                    
                    showPage('dashboard');
                    loadDashboardData();
                } else {
                    showToast(response.message || '认证失败', 'error');
                }
            } catch (error) {
                console.error('认证错误:', error);
                showToast('认证失败，请检查网络连接', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = '开始使用';
            }
        }

        // 处理退出登录
        function handleLogout() {
            localStorage.removeItem('healthsmart_user');
            currentUser = null;
            showToast('已退出登录', 'info');
            showPage('login');
        }

        // 显示页面
        function showPage(pageName) {
            // 隐藏所有页面
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
            });
            
            // 显示目标页面
            const targetPage = document.getElementById(pageName + '-page');
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }
            
            // 更新导航高亮
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.page === pageName) {
                    item.classList.add('active');
                }
            });
            
            // 更新页面标题
            const titles = {
                'dashboard': '数据概览',
                'health-report': '健康报告',
                'daily-plan': '每日计划',
                'nutrition': '饮食建议',
                'exercise': '运动计划',
                'reminders': '提醒通知',
                'statistics': '数据统计',
                'settings': '个人设置'
            };
            document.getElementById('pageTitle').textContent = titles[pageName] || '健康智护';
            
            // 加载页面数据
            loadPageData(pageName);
        }

        // 加载页面数据
        function loadPageData(pageName) {
            if (!currentUser) return;
            
            switch (pageName) {
                case 'dashboard':
                    loadDashboardData();
                    break;
                case 'daily-plan':
                    loadDailyPlanData();
                    break;
                case 'statistics':
                    loadStatisticsData();
                    break;
                case 'settings':
                    loadProfileData();
                    break;
            }
        }

        // 加载仪表盘数据
        async function loadDashboardData() {
            try {
                const response = await HealthSmartAPI.getDashboardData(currentUser.userId);
                if (response.success) {
                    updateDashboard(response.data);
                }
            } catch (error) {
                console.error('加载仪表盘数据错误:', error);
            }
        }

        // 更新仪表盘
        function updateDashboard(data) {
            // 更新热量
            if (data.calorie) {
                document.getElementById('calorieCurrent').textContent = data.calorie.current || 0;
                document.getElementById('calorieTarget').textContent = data.calorie.target || 2000;
                
                const percentage = Math.min((data.calorie.current / data.calorie.target) * 100, 100);
                document.getElementById('calorieProgress').style.strokeDashoffset = 283 - (283 * percentage / 100);
            }
            
            // 更新宏量元素
            if (data.macros) {
                document.getElementById('proteinValue').textContent = (data.macros.protein || 0) + 'g';
                document.getElementById('carbsValue').textContent = (data.macros.carbs || 0) + 'g';
                document.getElementById('fatValue').textContent = (data.macros.fat || 0) + 'g';
                
                document.getElementById('proteinBar').style.width = Math.min((data.macros.protein / 100) * 100, 100) + '%';
                document.getElementById('carbsBar').style.width = Math.min((data.macros.carbs / 300) * 100, 100) + '%';
                document.getElementById('fatBar').style.width = Math.min((data.macros.fat / 65) * 100, 100) + '%';
            }
            
            // 更新打卡
            if (data.streak) {
                document.getElementById('currentStreak').textContent = data.streak.current || 0;
                document.getElementById('totalDays').textContent = data.streak.total || 0;
                document.getElementById('bestStreak').textContent = data.streak.best || 0;
            }
            
            // 更新健康指标
            if (data.healthMetrics) {
                document.getElementById('bmiValue').textContent = data.healthMetrics.bmi || '--';
                document.getElementById('weightValue').textContent = data.healthMetrics.weight || '--';
                document.getElementById('sleepValue').textContent = data.healthMetrics.sleep || '--';
                document.getElementById('exerciseValue').textContent = data.healthMetrics.exercise || '--';
                
                // 更新BMI状态
                const bmiStatus = document.getElementById('bmiStatus');
                const bmi = data.healthMetrics.bmi;
                if (bmi) {
                    if (bmi < 18.5) {
                        bmiStatus.textContent = '偏瘦';
                        bmiStatus.className = 'metric-status warning';
                    } else if (bmi < 24) {
                        bmiStatus.textContent = '正常';
                        bmiStatus.className = 'metric-status success';
                    } else if (bmi < 28) {
                        bmiStatus.textContent = '偏胖';
                        bmiStatus.className = 'metric-status warning';
                    } else {
                        bmiStatus.textContent = '肥胖';
                        bmiStatus.className = 'metric-status danger';
                    }
                }
            }
            
            // 更新今日任务
            if (data.todayTasks) {
                updateTaskList(data.todayTasks);
            }
        }

        // 更新任务列表
        function updateTaskList(tasks) {
            const container = document.getElementById('todayTasks');
            if (!tasks || tasks.length === 0) {
                container.innerHTML = '<div class="task-empty">暂无今日任务</div>';
                return;
            }
            
            container.innerHTML = tasks.map(task => `
                <div class="task-item ${task.completed ? 'completed' : ''}" onclick="toggleTask(${task.taskId})">
                    <div class="task-checkbox ${task.completed ? 'checked' : ''}">
                        ${task.completed ? '✓' : ''}
                    </div>
                    <div class="task-content">
                        <span class="task-title">${task.title}</span>
                        <span class="task-time">${task.time || ''}</span>
                    </div>
                    <span class="task-type ${task.type}">${task.typeName || ''}</span>
                </div>
            `).join('');
        }

        // 切换侧边栏
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('collapsed');
        }

        // 更新日期显示
        function updateDateDisplay() {
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('todayDate').textContent = new Date().toLocaleDateString('zh-CN', options);
            document.getElementById('selectedDate').textContent = selectedDate.toLocaleDateString('zh-CN', options);
        }

        // 改变日期
        function changeDate(delta) {
            selectedDate.setDate(selectedDate.getDate() + delta);
            updateDateDisplay();
            loadDailyPlanData();
        }

        // 生成日历条纹
        function generateCalendarStrip() {
            const container = document.getElementById('calendarStrip');
            const today = new Date();
            let html = '';
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const isToday = i === 0;
                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''}">
                        <span class="day-name">${date.getDate()}</span>
                        <span class="day-status"></span>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        // 加载每日计划数据
        async function loadDailyPlanData() {
            try {
                const response = await HealthSmartAPI.getDailyPlan(currentUser.userId, formatDate(selectedDate));
                if (response.success) {
                    updateDailyPlan(response.data);
                }
            } catch (error) {
                console.error('加载每日计划错误:', error);
            }
        }

        // 更新每日计划
        function updateDailyPlan(data) {
            if (!data) return;
            
            // 更新饮食
            document.getElementById('mealBreakfast').innerHTML = data.mealBreakfast || '<p class="meal-empty">暂无早餐建议</p>';
            document.getElementById('mealLunch').innerHTML = data.mealLunch || '<p class="meal-empty">暂无午餐建议</p>';
            document.getElementById('mealDinner').innerHTML = data.mealDinner || '<p class="meal-empty">暂无晚餐建议</p>';
            document.getElementById('mealSnacks').innerHTML = data.mealSnacks || '<p class="meal-empty">暂无加餐建议</p>';
            
            // 更新运动
            document.getElementById('exerciseType').textContent = data.exerciseType || '--';
            document.getElementById('exerciseDuration').textContent = (data.exerciseDuration || '--') + ' 分钟';
            document.getElementById('exerciseIntensity').textContent = getIntensityText(data.exerciseIntensity);
            document.getElementById('exerciseDescription').textContent = data.exerciseDescription || '暂无运动计划';
            
            // 更新热量
            document.getElementById('dailyCalorieGoal').textContent = (data.dailyCalorieGoal || '--') + ' 千卡';
            
            // 更新提醒
            const remindersContainer = document.getElementById('dailyReminders');
            if (data.reminders && data.reminders.length > 0) {
                remindersContainer.innerHTML = data.reminders.map(r => `
                    <div class="reminder-item">
                        <span class="reminder-icon">📌</span>
                        <span class="reminder-text">${r}</span>
                    </div>
                `).join('');
            } else {
                remindersContainer.innerHTML = '<div class="reminder-empty">暂无提醒</div>';
            }
        }

        // 获取强度文本
        function getIntensityText(intensity) {
            const map = {
                'low': '低强度',
                'medium': '中强度',
                'high': '高强度'
            };
            return map[intensity] || '--';
        }

        // 加载统计数据
        async function loadStatisticsData() {
            try {
                const response = await HealthSmartAPI.getStatistics(currentUser.userId, currentPeriod);
                if (response.success) {
                    updateStatistics(response.data);
                }
            } catch (error) {
                console.error('加载统计数据错误:', error);
            }
        }

        // 更新统计数据
        function updateStatistics(data) {
            if (!data) return;
            
            // 更新完成率
            const completionRate = data.completionRate || 0;
            document.getElementById('completionRate').textContent = completionRate.toFixed(0) + '%';
            document.getElementById('completionProgress').style.strokeDashoffset = 283 - (283 * completionRate / 100);
            
            // 更新热量
            document.getElementById('plannedCalories').textContent = (data.plannedCalories || 0) + ' 千卡';
            document.getElementById('actualCalories').textContent = (data.actualCalories || 0) + ' 千卡';
            document.getElementById('calorieDeviation').textContent = (data.calorieDeviation || 0) + ' 千卡';
            
            // 更新运动
            document.getElementById('plannedExercise').textContent = (data.plannedExercise || 0) + ' 分钟';
            document.getElementById('actualExercise').textContent = (data.actualExercise || 0) + ' 分钟';
            
            // 更新柱状图
            updateBarChart(data.dailyCompletion || []);
        }

        // 更新柱状图
        function updateBarChart(data) {
            const container = document.getElementById('barChart');
            if (!data || data.length === 0) {
                container.innerHTML = '<div class="chart-empty">暂无数据</div>';
                return;
            }
            
            container.innerHTML = data.map(day => `
                <div class="bar-item">
                    <div class="bar" style="height: ${day.completion}%"></div>
                    <span class="bar-label">${day.label}</span>
                </div>
            `).join('');
        }

        // 切换时间段
        function changePeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.includes(getPeriodText(period))) {
                    btn.classList.add('active');
                }
            });
            loadStatisticsData();
        }

        function getPeriodText(period) {
            const map = { 'week': '本周', 'month': '本月', 'all': '全部' };
            return map[period] || '';
        }

        // 加载个人资料
        function loadProfileData() {
            if (!currentUser) return;
            
            document.getElementById('profileUsername').value = currentUser.username || '';
            document.getElementById('profileNickname').value = currentUser.nickname || '';
            document.getElementById('profileEmail').value = currentUser.email || '';
            document.getElementById('profilePhone').value = currentUser.phone || '';
            document.getElementById('profileGender').value = currentUser.gender || '';
            document.getElementById('profileBirthDate').value = currentUser.birthDate || '';
        }

        // 处理资料更新
        async function handleProfileUpdate(event) {
            event.preventDefault();
            
            const profileData = {
                userId: currentUser.userId,
                nickname: document.getElementById('profileNickname').value,
                email: document.getElementById('profileEmail').value,
                phone: document.getElementById('profilePhone').value,
                gender: document.getElementById('profileGender').value,
                birthDate: document.getElementById('profileBirthDate').value
            };
            
            try {
                const response = await HealthSmartAPI.updateProfile(profileData);
                if (response.success) {
                    currentUser = { ...currentUser, ...profileData };
                    localStorage.setItem('healthsmart_user', JSON.stringify(currentUser));
                    updateUserDisplay();
                    showToast('资料更新成功', 'success');
                } else {
                    showToast(response.message || '更新失败', 'error');
                }
            } catch (error) {
                console.error('更新资料错误:', error);
                showToast('更新失败', 'error');
            }
        }

        // 处理健康报告提交
        async function handleReportSubmit(event) {
            event.preventDefault();
            
            const report = {
                userId: currentUser.userId,
                height: parseFloat(document.getElementById('height').value),
                weight: parseFloat(document.getElementById('weight').value),
                bodyFatRate: parseFloat(document.getElementById('bodyFatRate').value) || null,
                muscleMass: parseFloat(document.getElementById('muscleMass').value) || null,
                systolicPressure: parseInt(document.getElementById('systolicPressure').value) || null,
                diastolicPressure: parseInt(document.getElementById('diastolicPressure').value) || null,
                sleepHoursAvg: parseFloat(document.getElementById('sleepHoursAvg').value) || null,
                sleepQuality: parseInt(document.getElementById('sleepQuality').value) || null,
                smoking: document.getElementById('smoking').value === 'true',
                drinking: document.getElementById('drinking').value === 'true',
                exerciseFrequency: parseInt(document.getElementById('exerciseFrequency').value) || null,
                dietaryPreferences: document.getElementById('dietaryPreferences').value,
                foodAllergies: document.getElementById('foodAllergies').value,
                healthGoal: document.getElementById('healthGoal').value,
                targetWeight: parseFloat(document.getElementById('targetWeight').value) || null,
                stressLevel: parseInt(document.getElementById('stressLevel').value) || null,
                energyLevel: parseInt(document.getElementById('energyLevel').value) || null,
                medicalHistory: document.getElementById('medicalHistory').value,
                medications: document.getElementById('medications').value,
                additionalNotes: document.getElementById('additionalNotes').value
            };
            
            try {
                showToast('正在提交报告...', 'info');
                const response = await HealthSmartAPI.submitHealthReport(report);
                if (response.success) {
                    showToast('健康报告提交成功！正在生成计划...', 'success');
                    // 生成计划
                    await HealthSmartAPI.generatePlan(currentUser.userId, response.data.reportId);
                    showToast('个性化计划生成完成！', 'success');
                    showPage('dashboard');
                    loadDashboardData();
                } else {
                    showToast(response.message || '报告提交失败', 'error');
                }
            } catch (error) {
                console.error('提交报告错误:', error);
                showToast('提交失败，请检查网络连接', 'error');
            }
        }

        // 重置报告表单
        function resetReportForm() {
            document.getElementById('health-report-form').reset();
        }

        // 显示通知
        function showNotifications() {
            const modal = document.getElementById('notification-modal');
            const content = document.getElementById('notificationContent');
            content.innerHTML = '<p>暂无新通知</p>';
            modal.classList.remove('hidden');
        }

        // 关闭通知弹窗
        function closeNotificationModal() {
            document.getElementById('notification-modal').classList.add('hidden');
        }

        // 显示帮助
        function showHelp() {
            document.getElementById('help-modal').classList.remove('hidden');
        }

        // 关闭帮助弹窗
        function closeHelpModal() {
            document.getElementById('help-modal').classList.add('hidden');
        }

        // 显示 Toast
        function showToast(message, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <span class="toast-icon">${getToastIcon(type)}</span>
                <span class="toast-message">${message}</span>
            `;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('fade-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        function getToastIcon(type) {
            const map = {
                'success': '✓',
                'error': '✗',
                'warning': '⚠',
                'info': 'ℹ'
            };
            return map[type] || 'ℹ';
        }

        // 格式化日期
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }
    </script>
</body>
</html>